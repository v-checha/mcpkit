"use strict";(globalThis.webpackChunkmcpkit_docs=globalThis.webpackChunkmcpkit_docs||[]).push([[932],{8453(e,n,r){r.d(n,{R:()=>t,x:()=>l});var i=r(6540);const o={},s=i.createContext(o);function t(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(s.Provider,{value:n},e.children)}},8741(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>g,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"observability/debugging","title":"Debugging","description":"The @Debug decorator provides detailed logging for your MCP server tools, resources, and prompts. This is especially useful when developing locally or troubleshooting issues with Claude Desktop.","source":"@site/docs/observability/debugging.md","sourceDirName":"observability","slug":"/observability/debugging","permalink":"/mcpkit/docs/observability/debugging","draft":false,"unlisted":false,"editUrl":"https://github.com/v-checha/mcpkit/tree/main/docs/docs/observability/debugging.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4}}');var o=r(4848),s=r(8453);const t={sidebar_position:4},l="Debugging",a={},d=[{value:"Basic Usage",id:"basic-usage",level:2},{value:"Global Configuration",id:"global-configuration",level:2},{value:"Debug Options",id:"debug-options",level:2},{value:"Sanitizing Sensitive Data",id:"sanitizing-sensitive-data",level:2},{value:"Writing Logs to a File",id:"writing-logs-to-a-file",level:2},{value:"Rotating File Logger",id:"rotating-file-logger",level:2},{value:"Debugging in Claude Desktop",id:"debugging-in-claude-desktop",level:2},{value:"Finding MCP Logs",id:"finding-mcp-logs",level:3},{value:"Common Issues",id:"common-issues",level:3},{value:"Combining with Hooks",id:"combining-with-hooks",level:2},{value:"Using with MCP Inspector",id:"using-with-mcp-inspector",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"debugging",children:"Debugging"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"@Debug"})," decorator provides detailed logging for your MCP server tools, resources, and prompts. This is especially useful when developing locally or troubleshooting issues with Claude Desktop."]}),"\n",(0,o.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { createServer, MCPServer, Tool, Param, Debug } from '@mcpkit-dev/core';\n\n@MCPServer({ name: 'my-server', version: '1.0.0' })\nclass MyServer {\n  @Tool({ description: 'Add two numbers' })\n  @Debug()\n  async add(\n    @Param({ name: 'a' }) a: number,\n    @Param({ name: 'b' }) b: number\n  ): Promise<number> {\n    return a + b;\n  }\n}\n\nconst server = createServer(MyServer);\nserver.listen();\n"})}),"\n",(0,o.jsxs)(n.p,{children:["By default, ",(0,o.jsx)(n.code,{children:"@Debug"})," logs to ",(0,o.jsx)(n.code,{children:"stderr"})," (which appears in Claude Desktop's MCP logs). Output looks like:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"[2024-12-22T14:30:00.000Z] [DEBUG] \u2192 tool:add { type: 'tool', name: 'add', args: [5, 3] }\n[2024-12-22T14:30:00.005Z] [DEBUG] \u2190 tool:add \u2713 { type: 'tool', name: 'add', duration: '5ms', result: 8 }\n"})}),"\n",(0,o.jsx)(n.h2,{id:"global-configuration",children:"Global Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["Configure debug settings globally with ",(0,o.jsx)(n.code,{children:"configureDebug"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { configureDebug } from '@mcpkit-dev/core';\n\nconfigureDebug({\n  enabled: true,           // Enable/disable all @Debug decorators\n  level: 'debug',          // Minimum log level: 'trace' | 'debug' | 'info' | 'warn' | 'error'\n  logArgs: true,           // Log input arguments\n  logResult: true,         // Log return values\n  logDuration: true,       // Log execution time\n});\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Debug is automatically enabled when ",(0,o.jsx)(n.code,{children:"NODE_ENV=development"})," or ",(0,o.jsx)(n.code,{children:"MCPKIT_DEBUG=true"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"debug-options",children:"Debug Options"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"@Debug"})," decorator accepts these options:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"@Debug({\n  enabled: true,           // Override global enabled setting\n  level: 'debug',          // Minimum log level\n  logArgs: true,           // Log input arguments\n  logResult: true,         // Log return values\n  logDuration: true,       // Log execution time\n  label: 'custom-label',   // Custom label for log output\n  logger: customLogger,    // Custom logger implementation\n  sanitize: (key, value) => value,  // Sanitize sensitive data\n})\n"})}),"\n",(0,o.jsx)(n.h2,{id:"sanitizing-sensitive-data",children:"Sanitizing Sensitive Data"}),"\n",(0,o.jsxs)(n.p,{children:["By default, fields containing ",(0,o.jsx)(n.code,{children:"password"}),", ",(0,o.jsx)(n.code,{children:"token"}),", ",(0,o.jsx)(n.code,{children:"secret"}),", ",(0,o.jsx)(n.code,{children:"apiKey"}),", ",(0,o.jsx)(n.code,{children:"api_key"}),", or ",(0,o.jsx)(n.code,{children:"authorization"})," are redacted. You can customize this:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"@Tool({ description: 'Login user' })\n@Debug({\n  sanitize: (key, value) => {\n    if (key === 'password' || key === 'ssn') {\n      return '[REDACTED]';\n    }\n    return value;\n  },\n})\nasync login(\n  @Param({ name: 'username' }) username: string,\n  @Param({ name: 'password' }) password: string\n): Promise<string> {\n  // Password will be logged as [REDACTED]\n  return 'token';\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"writing-logs-to-a-file",children:"Writing Logs to a File"}),"\n",(0,o.jsx)(n.p,{children:"When debugging MCP servers running in Claude Desktop, it's helpful to write logs to a file. Here's a complete example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import 'reflect-metadata';\nimport {\n  createServer,\n  MCPServer,\n  Tool,\n  Param,\n  Debug,\n  configureDebug,\n  type DebugLogger,\n  type DebugLevel,\n} from '@mcpkit-dev/core';\nimport { appendFileSync, mkdirSync, existsSync } from 'fs';\nimport { dirname, join } from 'path';\nimport { fileURLToPath } from 'url';\n\n// Get the directory where this script is located (ESM)\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\n// Create logs in project root (one level up from dist/)\nconst logDir = join(__dirname, '..', 'logs');\nconst logFile = join(logDir, 'mcp-server.log');\n\n// Safely create log directory at startup\nif (!existsSync(logDir)) {\n  try {\n    mkdirSync(logDir, { recursive: true });\n  } catch {\n    // Silently fail - we'll handle errors when writing\n  }\n}\n\n// Create a file logger\nconst fileLogger: DebugLogger = {\n  log(level: DebugLevel, message: string, data?: Record<string, unknown>): void {\n    const timestamp = new Date().toISOString();\n    const logLine = JSON.stringify({\n      timestamp,\n      level,\n      message,\n      ...data,\n    }) + '\\n';\n\n    try {\n      appendFileSync(logFile, logLine);\n    } catch {\n      // Silent fail - don't crash the server for logging\n    }\n  },\n};\n\n// Configure globally\nconfigureDebug({\n  enabled: true,\n  logger: fileLogger,\n});\n\n@MCPServer({ name: 'my-server', version: '1.0.0' })\nclass MyServer {\n  @Tool({ description: 'Add two numbers together' })\n  @Debug()\n  async add(\n    @Param({ name: 'a', description: 'First number' }) a: number,\n    @Param({ name: 'b', description: 'Second number' }) b: number\n  ): Promise<number> {\n    return a + b;\n  }\n\n  @Tool({ description: 'Divide two numbers' })\n  @Debug({ level: 'info' })\n  async divide(\n    @Param({ name: 'a' }) a: number,\n    @Param({ name: 'b' }) b: number\n  ): Promise<number> {\n    if (b === 0) {\n      throw new Error('Division by zero');\n    }\n    return a / b;\n  }\n}\n\nconst server = createServer(MyServer);\n\nserver.listen().catch((error) => {\n  console.error('Failed to start server:', error);\n  process.exit(1);\n});\n"})}),"\n",(0,o.jsxs)(n.p,{children:["After running your server and calling tools, check ",(0,o.jsx)(n.code,{children:"./logs/mcp-server.log"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{"timestamp":"2024-12-22T14:30:00.000Z","level":"debug","message":"\u2192 tool:add","type":"tool","name":"add","args":[5,3]}\n{"timestamp":"2024-12-22T14:30:00.005Z","level":"debug","message":"\u2190 tool:add \u2713","type":"tool","name":"add","duration":"5ms","result":8}\n{"timestamp":"2024-12-22T14:30:01.000Z","level":"debug","message":"\u2192 tool:divide","type":"tool","name":"divide","args":[10,0]}\n{"timestamp":"2024-12-22T14:30:01.002Z","level":"error","message":"\u2190 tool:divide \u2717","type":"tool","name":"divide","error":"Division by zero","duration":"2ms"}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"rotating-file-logger",children:"Rotating File Logger"}),"\n",(0,o.jsx)(n.p,{children:"For production or long-running servers, implement log rotation:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { appendFileSync, mkdirSync, existsSync, statSync, renameSync } from 'fs';\nimport { join } from 'path';\nimport type { DebugLogger, DebugLevel } from '@mcpkit-dev/core';\n\nconst MAX_LOG_SIZE = 10 * 1024 * 1024; // 10MB\n\nfunction createRotatingFileLogger(logDir: string, filename: string): DebugLogger {\n  const logFile = join(logDir, filename);\n\n  // Ensure directory exists\n  if (!existsSync(logDir)) {\n    mkdirSync(logDir, { recursive: true });\n  }\n\n  function rotateIfNeeded(): void {\n    try {\n      const stats = statSync(logFile);\n      if (stats.size > MAX_LOG_SIZE) {\n        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n        renameSync(logFile, join(logDir, `${filename}.${timestamp}`));\n      }\n    } catch {\n      // File doesn't exist yet, no rotation needed\n    }\n  }\n\n  return {\n    log(level: DebugLevel, message: string, data?: Record<string, unknown>): void {\n      const timestamp = new Date().toISOString();\n      const logLine = JSON.stringify({ timestamp, level, message, ...data }) + '\\n';\n\n      try {\n        rotateIfNeeded();\n        appendFileSync(logFile, logLine);\n      } catch {\n        // Silent fail\n      }\n    },\n  };\n}\n\n// Usage\nconfigureDebug({\n  enabled: true,\n  logger: createRotatingFileLogger('./logs', 'mcp-server.log'),\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"debugging-in-claude-desktop",children:"Debugging in Claude Desktop"}),"\n",(0,o.jsx)(n.h3,{id:"finding-mcp-logs",children:"Finding MCP Logs"}),"\n",(0,o.jsx)(n.p,{children:"Claude Desktop logs MCP server output to:"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"macOS:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"tail -f ~/Library/Logs/Claude/mcp*.log\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Windows:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"%APPDATA%\\Claude\\logs\\mcp*.log\n"})}),"\n",(0,o.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Server disconnects immediately"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Run your server directly first: ",(0,o.jsx)(n.code,{children:"node dist/index.js"})]}),"\n",(0,o.jsxs)(n.li,{children:["Check for missing ",(0,o.jsx)(n.code,{children:"reflect-metadata"})," import"]}),"\n",(0,o.jsxs)(n.li,{children:["Verify ",(0,o.jsx)(n.code,{children:"experimentalDecorators"})," and ",(0,o.jsx)(n.code,{children:"emitDecoratorMetadata"})," in tsconfig"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Tools not appearing"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Tools don't show in UI - they're available to Claude automatically"}),"\n",(0,o.jsx)(n.li,{children:'Ask Claude to use your tool: "Use the add tool to calculate 5 + 3"'}),"\n",(0,o.jsx)(n.li,{children:"Check logs to verify tools are registered"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Path issues with file logging"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"import.meta.url"})," and ",(0,o.jsx)(n.code,{children:"fileURLToPath"})," for ESM modules"]}),"\n",(0,o.jsxs)(n.li,{children:["Use absolute paths based on ",(0,o.jsx)(n.code,{children:"__dirname"})]}),"\n",(0,o.jsx)(n.li,{children:"Create log directory at startup, not in the logger"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"combining-with-hooks",children:"Combining with Hooks"}),"\n",(0,o.jsxs)(n.p,{children:["For more comprehensive logging, combine ",(0,o.jsx)(n.code,{children:"@Debug"})," with server hooks:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"@MCPServer({\n  name: 'my-server',\n  version: '1.0.0',\n  hooks: {\n    onServerStart: () => {\n      console.error('[my-server] Server started');\n    },\n    onServerStop: () => {\n      console.error('[my-server] Server stopped');\n    },\n    onToolCall: ({ toolName, args }) => {\n      console.error(`[my-server] Tool \"${toolName}\" called with:`, args);\n    },\n    onToolError: ({ toolName, error }) => {\n      console.error(`[my-server] Tool \"${toolName}\" failed:`, error.message);\n    },\n  },\n})\nclass MyServer {\n  @Tool({ description: 'My tool' })\n  @Debug()\n  async myTool(): Promise<string> {\n    return 'done';\n  }\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"using-with-mcp-inspector",children:"Using with MCP Inspector"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"https://github.com/modelcontextprotocol/inspector",children:"MCP Inspector"})," is a visual debugging tool:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"npx @modelcontextprotocol/inspector node dist/index.js\n"})}),"\n",(0,o.jsx)(n.p,{children:"This opens a web UI where you can:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"See all registered tools, resources, and prompts"}),"\n",(0,o.jsx)(n.li,{children:"Test tools with custom inputs"}),"\n",(0,o.jsx)(n.li,{children:"View request/response payloads"}),"\n",(0,o.jsx)(n.li,{children:"Debug without Claude Desktop"}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);