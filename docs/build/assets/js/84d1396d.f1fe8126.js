"use strict";(globalThis.webpackChunkmcpkit_docs=globalThis.webpackChunkmcpkit_docs||[]).push([[748],{1712(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>m,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"advanced/middleware","title":"Middleware","description":"Middleware allows you to intercept and process HTTP requests before they reach your tools.","source":"@site/docs/advanced/middleware.md","sourceDirName":"advanced","slug":"/advanced/middleware","permalink":"/mcpkit/docs/advanced/middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/mcpkit-dev/mcpkit/tree/main/docs/docs/advanced/middleware.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Distributed Tracing with @Traced","permalink":"/mcpkit/docs/guides/tracing-decorator"},"next":{"title":"Middleware Utilities","permalink":"/mcpkit/docs/advanced/middleware-utilities"}}');var d=t(4848),i=t(8453);const a={sidebar_position:1},s="Middleware",o={},l=[{value:"Creating Middleware",id:"creating-middleware",level:2},{value:"Using Middleware",id:"using-middleware",level:2},{value:"Middleware Context",id:"middleware-context",level:2},{value:"Named Middleware",id:"named-middleware",level:2},{value:"Middleware Chain Enhancements",id:"middleware-chain-enhancements",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"middleware",children:"Middleware"})}),"\n",(0,d.jsx)(n.p,{children:"Middleware allows you to intercept and process HTTP requests before they reach your tools."}),"\n",(0,d.jsx)(n.h2,{id:"creating-middleware",children:"Creating Middleware"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"import { Middleware, MiddlewareContext, NextFunction } from '@mcpkit-dev/core';\n\nconst loggingMiddleware: Middleware = async (ctx, next) => {\n  const start = Date.now();\n  console.log(`\u2192 ${ctx.method} ${ctx.path}`);\n\n  await next();\n\n  console.log(`\u2190 ${ctx.method} ${ctx.path} (${Date.now() - start}ms)`);\n};\n"})}),"\n",(0,d.jsx)(n.h2,{id:"using-middleware",children:"Using Middleware"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"@MCPServer({\n  name: 'my-server',\n  version: '1.0.0',\n  middleware: [loggingMiddleware, authMiddleware],\n})\nclass MyServer {}\n"})}),"\n",(0,d.jsx)(n.h2,{id:"middleware-context",children:"Middleware Context"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"interface MiddlewareContext {\n  request: IncomingMessage;\n  response: ServerResponse;\n  sessionId?: string;\n  url: URL;\n  method: string;\n  path: string;\n  body?: unknown;\n  state: Map<string, unknown>;\n  get<T>(key: string): T | undefined;\n  set<T>(key: string, value: T): void;\n}\n"})}),"\n",(0,d.jsx)(n.h2,{id:"named-middleware",children:"Named Middleware"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"import { NamedMiddleware } from '@mcpkit-dev/core';\n\nconst corsMiddleware: NamedMiddleware = {\n  name: 'cors',\n  handler: async (ctx, next) => {\n    ctx.response.setHeader('Access-Control-Allow-Origin', '*');\n    await next();\n  },\n  options: {\n    paths: ['/api/*'],\n    order: 1,\n  },\n};\n"})}),"\n",(0,d.jsx)(n.h2,{id:"middleware-chain-enhancements",children:"Middleware Chain Enhancements"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"import {\n  conditional,\n  withTimeout,\n  withRetry,\n  withErrorHandler,\n} from '@mcpkit-dev/core';\n\n// Conditional execution\nconst adminOnly = conditional(authMiddleware, {\n  when: (ctx) => ctx.path.startsWith('/admin'),\n});\n\n// With timeout\nconst withTimeoutMiddleware = withTimeout(slowMiddleware, {\n  ms: 5000,\n  onTimeout: () => console.log('Timed out'),\n});\n\n// With retry\nconst withRetryMiddleware = withRetry(unreliableMiddleware, {\n  attempts: 3,\n  delay: 1000,\n});\n\n// With error handling\nconst safeMiddleware = withErrorHandler(riskyMiddleware, {\n  onError: (error, ctx) => {\n    console.error('Middleware error:', error);\n    ctx.response.statusCode = 500;\n  },\n});\n"})})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>s});var r=t(6540);const d={},i=r.createContext(d);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);